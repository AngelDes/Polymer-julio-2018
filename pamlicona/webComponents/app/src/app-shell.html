<template id="myTemplate">
  <style>
    :host {
      --primary-color: darkblue;
    }

    .header {
      align-items: center;
      background-color: var(--primary-color);
      border-bottom: 1px solid darkgray;
      display: flex;
      height: 100px;
      justify-content: center;
    }

    .header__title {
      color: white;
    }

    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      margin-top: 75px;
    }
  </style>

  <header class="header">
    <h2 class="header__title">Contactos</h2>
  </header>

  <section class="container">
    <show-contact></show-contact>
    <div class="cards">
      <form-contact></form-contact>
    </div>
  </section>


</template>

<script>
  (function appShell(customElements) {
    class AppShell extends HTMLElement {
      constructor() {
        super();
        this.apiUrl = 'https://randomuser.me/api/?results=3';

        const template = document.currentScript.ownerDocument.querySelector('#myTemplate');
        const shadowRoot = this.attachShadow({mode: 'open'});

        shadowRoot.appendChild(document.importNode(template.content, true));
      }

      connectedCallback() {
        fetch(this.apiUrl)
          .then(resp => resp.json())
          .then(resp => {
            this.sendData(resp);
          })
        this.addEventListener('show-contact', this.setItem);
        this.addEventListener('new-contact', this.getNewItem);
      }

      getNewItem(event) {
        const item = event.detail;
        this.createCard(item)
      }

      setItem(event) {
        const item = event.detail;
        const showContact = this.shadowRoot.querySelector('show-contact');
        showContact.setAttribute('item', item);
      }

      createCard(item) {
        const cardContainer = this.shadowRoot.querySelector('.cards');
        let itemString = JSON.stringify(item);
        cardContainer.innerHTML += `<card-contact item='${itemString}'></card-contact>`
      }

      sendData(resp) {
        for (let item of resp.results) {
          this.createCard(item);
        }
      }
    }
    customElements.define('app-shell', AppShell);
  })(window.customElements);
</script>
